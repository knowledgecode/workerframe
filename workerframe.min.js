/*
 workerframe (c) 2015 KNOWLEDGECODE | MIT
*/
(function(f){var k=f.URL||f.webkitURL,l=function(){var c=f.BlobBuilder||f.WebKitBlobBuilder||f.MSBlobBuilder;return c?function(b,a){var d=new c;d.append(b[0]);return d.getBlob(a.type)}:f.Blob}(),g=function(c){var b=this;if(this===window||"function"!==typeof c)throw new TypeError("Failed to construct 'WorkerFrame'.");this._uid=Math.random().toString(36).slice(2);c=k.createObjectURL(new l(["(%s('%s', '%s', %s));".replace("%s",String(function(a,d,b){var e={},c=Array.prototype.slice;self.origin=a;self.emit=
function(a,b,e){postMessage({_type:d+a,_data:b},e)};self.bind=function(a,b){a="close"===a?d+"_c":d+a;return e[a]?null:e[a]=b};self.unbind=function(a){a="close"===a?d+"_c":d+a;delete e[a]};self.console||(self.console={log:function(){postMessage({_type:d+"_l",_data:c.call(arguments)})}});self.addEventListener("message",function(a){var b=(a.data||{})._type;a=(a.data||{})._data;var c;if(b){if(c=e[b])try{c(a,function(a){postMessage({_type:b+"_p",_data:{_ok:!0,_data:a}})},function(a){postMessage({_type:b+
"_p",_data:{_ok:!1,_data:a}})})}catch(h){postMessage({_type:b+"_p",_data:{_ok:!1,_data:h.message}})}b===d+"_c"&&(postMessage({_type:b}),e=void 0,self.close())}},!1);b()})).replace("%s",location.origin.replace("null","file://")).replace("%s",this._uid).replace("%s",String(c))],{type:"text/javascript"}));this._l={};this._o={};this._p={};this._w=new Worker(c);this._w.addEventListener("message",function(a){var d=(a.data||{})._type||"";a=(a.data||{})._data;switch(d){case b._uid+"_l":console.log.apply(console,
a);break;case b._uid+"_c":b._l=b._o=b._p=b._w=void 0;break;case "":break;default:b._d(d,a)}},!1);this._w.addEventListener("error",function(a){b._d(b._uid+"error",a)},!1);k.revokeObjectURL(c)};g.prototype=new function(){var c=function(a,d,b){var e=a[d]||[];0>e.indexOf(b)&&(e.push(b),a[d]=e);return b},b=function(a,b,c){var e=a[b]||[];c?(a=e.indexOf(c),0<=a&&e.splice(a,1)):delete a[b]};this.send=function(a,b,h){var e=this,g;a=this._uid+a;f.Promise&&"function"===typeof f.Promise&&(g=new Promise(function(b,
d){c(e._p,a+"_p",function(a){a._ok?b(a._data):d(a._data)})}));this._w.postMessage({_type:a,_data:b},h);return g};this.close=function(){this.send("_c")};this.on=function(a,b){return c(this._l,this._uid+a,b)};this.one=function(a,b){return c(this._o,this._uid+a,b)};this.off=function(a,d){b(this._l,this._uid+a,d);b(this._o,this._uid+a,d)};this._d=function(a,b){var c=function(a){a(b)};(this._l[a]||[]).map(c);(this._o[a]||[]).map(c);(this._p[a]||[]).map(c);delete this._o[a];delete this._p[a]}};g.prototype.constructor=
g;"function"===typeof define&&define.amd?define([],function(){return g}):f.WorkerFrame=g})(this);
